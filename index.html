<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GlobalGlide360 - Itinerari AI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',Arial,sans-serif;color:#222;background:#fff;line-height:1.4;}
    header{
      position:fixed;top:0;left:0;width:100%;
      background:rgba(255,255,255,0.97);backdrop-filter:blur(8px);
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 30px;box-shadow:0 4px 8px rgba(0,0,0,0.1);z-index:1000;
    }
    header img{height:65px;}
    header h1{color:#0077b6;font-size:24px;margin-left:8px;letter-spacing:1px;}

    .hero{position:relative;height:70vh;overflow:hidden;display:flex;align-items:center;justify-content:center;}
    .hero img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;}
    .hero::after{content:'';position:absolute;inset:0;background:rgba(0,0,0,0.45);}
    .hero-content{position:relative;z-index:1;text-align:center;color:white;padding:20px;max-width:850px;animation:fadeIn 1.2s ease;}
    .hero-content h2{font-size:38px;margin-bottom:15px;}
    .hero-content p{font-size:18px;}

    .search-section{background:#f1f7fb;padding:40px 20px;text-align:center;}
    .search-section h3{font-size:22px;margin-bottom:15px;color:#0077b6;}
    .search-section form{display:grid;gap:12px;max-width:780px;margin:0 auto;}
    .search-section input, .search-section select{
      padding:14px;border:1px solid #ccc;border-radius:8px;font-size:16px;width:100%;
    }
    .search-section button{
      background:#0077b6;color:white;padding:14px;border:none;border-radius:8px;font-size:18px;cursor:pointer;
      transition:all 0.3s;
    }
    .search-section button:hover{background:#00b4d8;}

    .preferences{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;}
    .preferences label{font-size:14px;}

    #results{max-width:1000px;margin:30px auto;padding:10px;animation:fadeIn 1s ease;}
    .card{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);margin-bottom:25px;}
    .card h3{margin-bottom:10px;color:#0077b6;font-size:20px;border-bottom:1px solid #eee;padding-bottom:8px;}
    .card p, .card a{font-size:16px;line-height:1.4;}

    .options{display:grid;gap:12px;}
    .option{
      display:flex;align-items:center;gap:12px;
      border:1px solid #ddd;border-radius:8px;padding:10px;background:#fafafa;
    }
    .option img{width:90px;height:70px;object-fit:cover;border-radius:6px;}
    .option-info{flex:1;}
    .option-info strong{color:#0077b6;display:block;font-size:16px;}
    .option a{font-size:14px;color:#00b4d8;}

    .timeline{margin:20px 0;}
    .day-card{
      background:#f8f9fa;margin-bottom:20px;padding:15px;border-radius:10px;
      border-left:5px solid #0077b6;animation:slideIn 0.7s ease;
    }
    .day-card h4{color:#0077b6;margin-bottom:6px;font-size:18px;}
    .day-card p{font-size:15px;line-height:1.4;margin-bottom:5px;}

    #download-pdf{
      display:block;margin:20px auto;background:#00b4d8;color:white;border:none;
      padding:12px 18px;font-size:16px;border-radius:8px;cursor:pointer;display:none;
    }

    footer{background:#222;color:#ccc;text-align:center;font-size:14px;padding:20px;margin-top:20px;}
    a{color:#0077b6;text-decoration:none;}
    a:hover{text-decoration:underline;}

    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideIn{from{transform:translateX(-20px);opacity:0}to{transform:translateX(0);opacity:1}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;">
      <img src="logo-globalglide360.png" alt="GlobalGlide360">
      <h1>GlobalGlide360</h1>
    </div>
  </header>

  <section class="hero">
    <img src="hero-travel.png" alt="Hero Travel">
    <div class="hero-content">
      <h2>Il tuo viaggio perfetto, creato da un'AI</h2>
      <p>Voli, hotel, attivit√† e ristoranti organizzati in un itinerario completo e dinamico.</p>
    </div>
  </section>

  <section class="search-section">
    <h3>Crea il tuo itinerario personalizzato</h3>
    <form id="travel-form">
      <input type="text" name="origin" placeholder="Citt√† di partenza (es. Milano)" required>
      <input type="text" name="destinazione" placeholder="Destinazione (es. Parigi)" required>
      <input type="date" name="dataPartenza" required>
      <input type="date" name="dataRitorno" required>
      <input type="number" name="adulti" placeholder="Numero adulti" min="1" value="1" required>
      <input type="number" name="bambini" placeholder="Numero bambini (<12 anni)" min="0" value="0" required>

      <div class="preferences">
        <label><input type="checkbox" name="preferenze" value="cultura"> Cultura</label>
        <label><input type="checkbox" name="preferenze" value="avventura"> Avventura</label>
        <label><input type="checkbox" name="preferenze" value="relax"> Relax</label>
        <label><input type="checkbox" name="preferenze" value="cibo"> Cibo</label>
        <label><input type="checkbox" name="preferenze" value="famiglia"> Famiglia</label>
      </div>

      <button type="submit">Cerca itinerario</button>
    </form>
  </section>

  <div id="results"></div>
  <button id="download-pdf">üìÑ Scarica Itinerario in PDF</button>

  <footer>
    <p>¬© 2025 GlobalGlide360 ‚Äì Tutti i diritti riservati</p>
  </footer>

<script>
const form = document.getElementById("travel-form");
const results = document.getElementById("results");
const btnPDF = document.getElementById("download-pdf");

let currentItinerary = ""; // Stringa che raccoglier√† il contenuto da salvare in PDF

form.addEventListener("submit", async e => {
  e.preventDefault();
  results.innerHTML = "<p style='text-align:center;'>‚è≥ Ricerca in corso...</p>";
  btnPDF.style.display = "none";

  const origin = form.elements["origin"].value;
  const destinazione = form.elements["destinazione"].value;
  const dataPartenza = form.elements["dataPartenza"].value;
  const dataRitorno = form.elements["dataRitorno"].value;
  const adulti = form.elements["adulti"].value;
  const bambini = form.elements["bambini"].value;
  const giorni = Math.max(1, Math.round((new Date(dataRitorno) - new Date(dataPartenza)) / (1000*60*60*24)) + 1);
  const preferenze = Array.from(form.querySelectorAll("input[name='preferenze']:checked")).map(cb => cb.value);

  try {
    // Chiamate API
    const resVoli = await fetch(`/api/voli?origin=${origin}&destinazione=${destinazione}&dataPartenza=${dataPartenza}&dataRitorno=${dataRitorno}`);
    const voli = (await resVoli.json()).data;

    const resHotel = await fetch(`/api/hotel?destinazione=${destinazione}&checkin=${dataPartenza}&checkout=${dataRitorno}&adulti=${adulti}&bambini=${bambini}`);
    const hotel = (await resHotel.json()).data;

    const resAttivita = await fetch(`/api/attivita?destinazione=${destinazione}&preferenze=${preferenze.join(",")}`);
    const attivita = (await resAttivita.json()).data;

    const resRistoranti = await fetch(`/api/ristoranti?destinazione=${destinazione}`);
    const ristoranti = (await resRistoranti.json()).data;

    // Costruzione HTML e stringa per PDF
    results.innerHTML = "";
    currentItinerary = `ITINERARIO PER ${destinazione.toUpperCase()}\n\n`;

    // Voli
    results.innerHTML += `<div class="card"><h3>‚úàÔ∏è Voli disponibili</h3>
      <div class="options">${voli.map(v=>{
        currentItinerary += `Volo: ${v.compagnia} - ‚Ç¨${v.prezzo} - Durata: ${v.durata}\n`;
        return `
        <div class="option">
          <img src="${v.img}" alt="${v.compagnia}">
          <div class="option-info">
            <strong>${v.compagnia}</strong>
            <span>Durata: ${v.durata}</span>
          </div>
          <strong>‚Ç¨${v.prezzo}</strong>
        </div>`}).join("")}
      </div>
    </div>\n`;

    // Hotel
    results.innerHTML += `<div class="card"><h3>üè® Hotel consigliati</h3>
      <div class="options">${hotel.map(h=>{
        currentItinerary += `Hotel: ${h.nome} - ‚Ç¨${h.prezzo}/notte - Valutazione: ${h.rating}\n`;
        return `
        <div class="option">
          <img src="${h.img}" alt="${h.nome}">
          <div class="option-info">
            <strong>${h.nome}</strong>
            <span>Valutazione: ${h.rating}</span>
            <p style="font-size:14px;">${h.descrizione}</p>
          </div>
          <strong>‚Ç¨${h.prezzo}/notte</strong>
        </div>`}).join("")}
      </div>
    </div>\n`;

    // Itinerario Giorno per Giorno
    results.innerHTML += `<div class="card"><h3>üóìÔ∏è Itinerario suggerito</h3>
      <div class="timeline">${Array.from({length: giorni}).map((_,g)=>{
        const attivit√†Filtrate = attivita.filter(a => preferenze.length === 0 || preferenze.includes(a.tipo));
        const attG = attivit√†Filtrate[g % attivit√†Filtrate.length];
        const commento = g===0 ? "Scopri la citt√† e ambientati." : "Attivit√† principali e tempo libero.";
        currentItinerary += `Giorno ${g+1}: ${commento}, ${attG ? attG.titolo : "Attivit√† libera"}\n`;
        return `
          <div class="day-card">
            <h4>Giorno ${g+1}</h4>
            <p>${commento}</p>
            <p>Mattina: ${attG ? attG.titolo+" (‚Ç¨"+attG.prezzo+")" : "Attivit√† libera"}</p>
            <p>Pranzo: ${ristoranti[0].nome} (‚òÖ${ristoranti[0].rating})</p>
            <p>Pomeriggio: ${attG ? attG.titolo+" (‚Ç¨"+attG.prezzo+")" : "Attivit√† libera"}</p>
            <p>Cena: ${ristoranti[1].nome} (‚òÖ${ristoranti[1].rating})</p>
          </div>`;
      }).join("")}</div>
    </div>`;

    btnPDF.style.display = "block";

  } catch (error) {
    console.error("Errore durante la ricerca:", error);
    results.innerHTML = "<p style='text-align:center;color:red;'>‚ùå Errore durante la ricerca. Riprova pi√π tardi.</p>";
  }
});

// DOWNLOAD PDF
btnPDF.addEventListener("click", () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFont("helvetica","normal");
  doc.setFontSize(12);
  const lines = doc.splitTextToSize(currentItinerary, 180);
  doc.text(lines, 15, 20);
  doc.save("Itinerario-GlobalGlide360.pdf");
});
</script>
</body>
</html>
