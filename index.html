<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GlobalGlide360 - Itinerari AI</title>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;}
    header,footer{background:#0077b6;color:white;text-align:center;padding:10px;}
    .container{max-width:800px;margin:20px auto;padding:10px;}
    form{display:grid;gap:10px;}
    input,select,button{padding:10px;font-size:16px;border-radius:6px;border:1px solid #ccc;}
    button{background:#0077b6;color:white;border:none;cursor:pointer;}
    #results{margin-top:20px;}
    .card{background:#f8f8f8;padding:10px;border-radius:6px;margin-bottom:10px;}
  </style>
</head>
<body>
  <header><h1>GlobalGlide360</h1></header>
  <div class="container">
    <h2>Crea il tuo itinerario</h2>
    <form id="travel-form">
      <input type="text" name="destinazione" placeholder="Destinazione (es. PAR)" required>
      <input type="date" name="data-partenza" required>
      <input type="date" name="data-ritorno" required>
      <button type="submit">Cerca Itinerario</button>
    </form>

    <div id="results"></div>
  </div>
  <footer><p>¬©2025 GlobalGlide360</p></footer>

<script>
const form = document.getElementById("travel-form");
const results = document.getElementById("results");

// Configurazione Amadeus (le tue credenziali)
const clientId = "kDR8582BVq2qikHZUQAaUBLlZNzTVp50";
const clientSecret = "6e8Wjj1R9axfFAIx";
let token = null;

// Ottieni Token Amadeus
async function getToken() {
  const res = await fetch("https://test.api.amadeus.com/v1/security/oauth2/token", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`
  });
  const data = await res.json();
  return data.access_token;
}

form.addEventListener("submit", async e => {
  e.preventDefault();
  results.innerHTML = "‚è≥ Ricerca in corso...";

  const destinazione = form.elements["destinazione"].value;
  const dataPartenza = form.elements["data-partenza"].value;

  // Prendi token se non presente
  if (!token) token = await getToken();

  try {
    // Chiamata voli
    const voli = await fetch(`https://test.api.amadeus.com/v2/shopping/flight-offers?originLocationCode=MIL&destinationLocationCode=${destinazione}&departureDate=${dataPartenza}&adults=1&currencyCode=EUR`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    const dataVoli = await voli.json();

    // Chiamata hotel
    const hotel = await fetch(`https://test.api.amadeus.com/v2/shopping/hotel-offers?cityCode=${destinazione}`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    const dataHotel = await hotel.json();

    // Chiamata attivit√†
    const attivita = await fetch(`https://test.api.amadeus.com/v1/shopping/activities?latitude=48.8566&longitude=2.3522&radius=10`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    const dataAttivita = await attivita.json();

    // Visualizza risultati
    results.innerHTML = "<h3>Itinerario trovato:</h3>";

    if (dataVoli.data && dataVoli.data.length > 0) {
      results.innerHTML += `<div class="card">‚úàÔ∏è Volo pi√π economico: ${dataVoli.data[0].price.total}‚Ç¨</div>`;
    } else {
      results.innerHTML += `<div class="card">‚úàÔ∏è Nessun volo trovato</div>`;
    }

    if (dataHotel.data && dataHotel.data.length > 0) {
      results.innerHTML += `<div class="card">üè® Hotel suggerito: ${dataHotel.data[0].hotel.name}</div>`;
    } else {
      results.innerHTML += `<div class="card">üè® Nessun hotel trovato</div>`;
    }

    if (dataAttivita.data && dataAttivita.data.length > 0) {
      results.innerHTML += `<div class="card">üéüÔ∏è Attivit√†: ${dataAttivita.data[0].name}</div>`;
    } else {
      results.innerHTML += `<div class="card">üéüÔ∏è Nessuna attivit√† trovata</div>`;
    }

  } catch (error) {
    console.error(error);
    results.innerHTML = "‚ùå Errore durante la ricerca. Controlla le credenziali API.";
  }
});
</script>
</body>
</html>
