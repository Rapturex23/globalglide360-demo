<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Itinerario - GlobalGlide360</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',Arial,sans-serif;color:#222;background:#fff;line-height:1.4;}
    header{
      position:fixed;top:0;left:0;width:100%;
      background:rgba(255,255,255,0.97);backdrop-filter:blur(8px);
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 30px;box-shadow:0 4px 8px rgba(0,0,0,0.1);z-index:1000;
    }
    header img{height:65px;}
    header h1{color:#0077b6;font-size:24px;margin-left:8px;letter-spacing:1px;}
    
    .container{max-width:1000px;margin:120px auto 40px;padding:20px;}
    .card{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);margin-bottom:25px;}
    .card h3{margin-bottom:10px;color:#0077b6;font-size:20px;border-bottom:1px solid #eee;padding-bottom:8px;}
    .day-card{
      background:#f8f9fa;margin-bottom:20px;padding:15px;border-radius:10px;
      border-left:5px solid #0077b6;animation:slideIn 0.7s ease;
    }
    .day-card h4{color:#0077b6;margin-bottom:6px;font-size:18px;}
    .day-card p{font-size:15px;line-height:1.4;margin-bottom:5px;}

    #download-pdf{
      display:block;margin:20px auto;background:#00b4d8;color:white;border:none;
      padding:12px 18px;font-size:16px;border-radius:8px;cursor:pointer;
    }

    footer{background:#222;color:#ccc;text-align:center;font-size:14px;padding:20px;margin-top:20px;}

    @keyframes slideIn{from{transform:translateX(-20px);opacity:0}to{transform:translateX(0);opacity:1}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;">
      <img src="logo-globalglide360.png" alt="GlobalGlide360">
      <h1>GlobalGlide360</h1>
    </div>
  </header>

  <div class="container">
    <h2 id="title-itinerario" style="margin-bottom:20px;color:#0077b6;">Caricamento itinerario...</h2>
    <div id="itinerario-container"></div>
    <button id="download-pdf">üìÑ Scarica in PDF</button>
  </div>

  <footer>
    <p>¬© 2025 GlobalGlide360 ‚Äì Tutti i diritti riservati</p>
  </footer>

<script>
const container = document.getElementById("itinerario-container");
const title = document.getElementById("title-itinerario");
const btnPDF = document.getElementById("download-pdf");

// Legge ID dall'URL
const params = new URLSearchParams(window.location.search);
const itinerarioId = params.get("id");

if(!itinerarioId){
  title.innerText = "‚ùå Nessun itinerario trovato";
  btnPDF.style.display = "none";
}else{
  // üîπ Dati temporanei simulati (in futuro chiameremo /api/itinerari?id=123)
  title.innerText = `Itinerario #${itinerarioId}`;
  container.innerHTML = `
    <div class="card">
      <h3>‚úàÔ∏è Voli</h3>
      <p>Partenza da Milano a Parigi il 10 agosto alle 10:00 - Ritorno il 12 agosto alle 19:00</p>
    </div>
    <div class="card">
      <h3>üè® Hotel</h3>
      <p>Hotel Lumi√®re 4‚òÖ - ‚Ç¨120/notte, vicino alla Torre Eiffel</p>
    </div>
    <div class="card">
      <h3>üçΩÔ∏è Ristoranti consigliati</h3>
      <p>Le Relais de l'Entrec√¥te, Le Souffl√©, L'Atelier de Jo√´l Robuchon</p>
    </div>
    <div class="card">
      <h3>üóìÔ∏è Itinerario Giorno per Giorno</h3>
      <div class="day-card">
        <h4>Giorno 1</h4>
        <p>Tour del Louvre e crociera sulla Senna</p>
      </div>
      <div class="day-card">
        <h4>Giorno 2</h4>
        <p>Visita a Montmartre e cena con vista</p>
      </div>
    </div>
  `;
}

// PDF export
btnPDF.addEventListener("click", () => {
  const { jsPDF } = window.jspdf;

  html2canvas(container, {scale:2}).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF('p','mm','a4');

    const logo = new Image();
    logo.src = "logo-globalglide360.png";
    logo.onload = () => {
      pdf.addImage(logo, 'PNG', 15, 10, 25, 18);
      pdf.setFont("helvetica","bold");
      pdf.setFontSize(16);
      pdf.text(`Itinerario #${itinerarioId}`, 50, 22);

      const imgWidth = 180;
      const pageHeight = 297;
      const imgHeight = canvas.height * imgWidth / canvas.width;
      let heightLeft = imgHeight;
      let position = 40;

      pdf.addImage(imgData, 'PNG', 15, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;

      while (heightLeft > 0) {
        position = heightLeft - imgHeight + 40;
        pdf.addPage();
        pdf.addImage(imgData, 'PNG', 15, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }

      pdf.save(`Itinerario-${itinerarioId}.pdf`);
    };
  });
});
</script>
</body>
</html>
